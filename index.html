<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Assistant - Directo a OpenAI (!!! CLAVE EXPUESTA !!!)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--text:#e6eef6}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071325 0%, #07162b 60%);color:var(--text);display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:920px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,0.6);overflow:hidden}
    header{display:flex;gap:16px;align-items:center;padding:18px 20px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4f46e5);display:flex;align-items:center;justify-content:center;font-weight:700}
    .title{font-size:18px;font-weight:700}
    .subtitle{font-size:12px;color:var(--muted)}
    main{display:flex;gap:20px;padding:20px}
    .left{flex:1;min-height:360px;display:flex;flex-direction:column}
    .chat{flex:1;overflow-y:auto;padding:10px;background:var(--card);border-radius:10px;margin-bottom:12px}
    .message{margin-bottom:10px}
    .user{color:var(--accent);font-weight:600}
    .input-box{display:flex;gap:10px}
    .input-box input{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:#111827;color:var(--text)}
    .input-box button{padding:10px 16px;border:none;border-radius:8px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">AI</div>
      <div>
        <div class="title">AI Assistant</div>
        <div class="subtitle">Interfaz HTML Directa</div>
      </div>
    </header>
    <main>
      <div class="left">
        <div class="chat" id="chatBox">
          <div class="message"><span class="user">AI:</span> ¡Hola! Soy tu asistente.</div>
        </div>
        <div class="input-box">
          <input type="text" id="userInput" placeholder="Escribe un mensaje..." />
          <button onclick="sendMessage()">Enviar</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // --- CONFIGURACIÓN DE LA API DE OPENAI (¡CLAVE EXPUESTA Y RIESGO ALTO!) ---
    // NO USES ESTO PARA PROYECTOS PÚBLICOS.
    // Eres responsable de cualquier coste o uso indebido de tu clave.

    const API_ENDPOINT = 'https://api.openai.com/v1/chat/completions';
    const API_KEY = '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'; // <--- ¡Pega tu NUEVA clave API aquí!

    // Almacena el historial de mensajes para que la IA recuerde el contexto
    const messagesHistory = [{ role: 'system', content: 'Eres un asistente de IA útil.' }];

    // Función para añadir mensajes al chat
    function addMessage(sender, text, isUser = false) {
      const chat = document.getElementById('chatBox');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message';
      if (isUser) {
        msgDiv.innerHTML = '<span class="user">Tú:</span> ' + text;
      } else {
        msgDiv.innerHTML = '<span class="user">AI:</span> ' + text;
      }
      chat.appendChild(msgDiv);
      chat.scrollTop = chat.scrollHeight; // Desplazar al final
    }

    // Función para enviar mensaje
    async function sendMessage(){
      const input = document.getElementById('userInput');
      const msg = input.value.trim();
      if (!msg) return;

      addMessage('You', msg, true); // Muestra el mensaje del usuario
      messagesHistory.push({ role: 'user', content: msg }); // Añade al historial
      input.value = ''; // Limpia el input

      // Deshabilita el input y el botón mientras la IA responde
      input.disabled = true;
      document.querySelector('.input-box button').disabled = true;
      addMessage('AI', 'Pensando...', false); // Mensaje de carga

      try {
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}` // Clave de autenticación para OpenAI (aquí expuesta)
          },
          body: JSON.stringify({
            messages: messagesHistory, // Envía el historial completo
            model: 'gpt-4o' // Puedes cambiar a 'gpt-3.5-turbo' si lo prefieres.
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          // Este error ahora debería ser de OpenAI si la clave es correcta
          throw new Error(`Error de la API de OpenAI: ${response.status} - ${errorData.message || response.statusText}`);
        }

        const data = await response.json();
        const aiResponse = data.choices[0].message.content; // Así se obtiene la respuesta de OpenAI

        // Elimina el mensaje de "Pensando..."
        const chat = document.getElementById('chatBox');
        if (chat.lastChild && chat.lastChild.textContent.includes('Pensando...')) {
          chat.removeChild(chat.lastChild);
        }
        
        addMessage('AI', aiResponse, false); // Muestra la respuesta real de la IA
        messagesHistory.push({ role: 'assistant', content: aiResponse }); // Añade la respuesta de la IA al historial

      } catch (error) {
        console.error('Error al comunicarse con la IA de OpenAI:', error);
        // Elimina el mensaje de "Pensando..." si todavía está ahí
        const chat = document.getElementById('chatBox');
        if (chat.lastChild && chat.lastChild.textContent.includes('Pensando...')) {
          chat.removeChild(chat.lastChild);
        }
        addMessage('AI', 'Lo siento, hubo un error al obtener la respuesta de la IA. Por favor, verifica tu clave API o la conexión. (Detalle: ' + error.message + ')', false);
      } finally {
        // Habilita el input y el botón de nuevo
        input.disabled = false;
        document.querySelector('.input-box button').disabled = false;
        input.focus(); // Vuelve a enfocar el input para una mejor UX
      }
    }
  </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"0f577d5365484c21bf52da7a0a037121","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
